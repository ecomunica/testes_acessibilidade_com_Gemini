<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>MÃ©tricas de Acessibilidade</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }

      body {
        display: flex;
        flex-direction: column;
      }

      main {
        flex: 1 0 auto;
      }

      .table-responsive {
        width: 100%;
        margin: 0 auto;
      }

      th {
        white-space: nowrap;
      }

      .logo-small {
        max-width: 160px;
        height: auto;
      }

      .btn-contrast-toggle {
        position: absolute;
        top: 1rem;
        right: 1rem;
      }

      .bg-azul {
        background-color: #205d8d;
        color: #fff;
      }

      .bg-azul:hover {
        background-color: #163f61 !important;
        color: #fff !important;
      }

      .pre-bruta {
        white-space: pre-wrap;
        background-color: #f1f1f1;
        padding: 1rem;
        border: 1px solid #ccc;
        border-radius: 6px;
      }

      .graficos-container {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        margin-top: 2rem;
      }

      #tabelaMetricas td,
      #tabelaMetricas th {
        word-break: break-word;
        white-space: normal !important;
      }

      footer {
        flex-shrink: 0;
        background-color: #163f61;
        color: #f1f1f1;
        padding: 20px 45px;
        font-size: 14px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
      }

      footer .imagem,
      footer .diretrizes,
      footer .github {
        flex: 1 1 200px;
        margin-bottom: 15px;
      }

      footer .imagem img {
        width: 160px;
        margin-right: 10px;
        margin-top: 10px;
      }

      footer .diretrizes a,
      footer .github a {
        color: #f1f1f1;
        font-size: 16px;
        text-decoration: underline;
      }

      footer .github img {
        width: 40px;
        margin-bottom: 5px;
      }

      @media (max-width: 768px) {
        footer {
          flex-direction: column;
          text-align: center;
        }
      }
    </style>
  </head>
  <body class="container my-4">
    <button
      class="btn btn-outline-dark btn-sm btn-contrast-toggle"
      onclick="toggleContrast()"
      aria-label="Ativar ou desativar contraste"
    >
      ðŸ”³ Modo escuro
    </button>
    <main class="container py-4">
      <div class="d-flex align-items-center mb-3">
        <img
          src="{{ url_for('static', filename='_avaliacao-de-acessibilidade-digital.png') }}"
          alt="Logo Acessibilidade Digital"
          class="logo-small me-3"
        />
        <h2 class="mb-0">ðŸ“ˆ MÃ©tricas de Acessibilidade</h2>
      </div>

      <div class="d-flex align-items-center justify-content-between gap-2 mb-2">
        <div class="gap-2 my-3">
          <h5>Filtrar por DeficiÃªncia:</h5>
          <button class="btn btn-primary" onclick="filtrar('deficiencia', '')">
            Todos
          </button>
          <button
            class="btn btn-secondary"
            onclick="filtrar('deficiencia', 'Auditiva')"
          >
            Auditiva
          </button>
          <button
            class="btn btn-secondary"
            onclick="filtrar('deficiencia', 'Visual')"
          >
            Visual
          </button>
          <button
            class="btn btn-secondary"
            onclick="filtrar('deficiencia', 'Motora')"
          >
            Motora
          </button>
          <button
            class="btn btn-secondary"
            onclick="filtrar('deficiencia', 'Cognitiva')"
          >
            Cognitiva
          </button>
        </div>

        <div class="gap-2 my-3">
          <h5>Filtrar por Severidade:</h5>
          <button class="btn btn-primary" onclick="filtrar('severidade', '')">
            Todos
          </button>
          <button
            class="btn btn-danger"
            onclick="filtrar('severidade', 'Alta')"
          >
            Alta
          </button>
          <button
            class="btn btn-warning"
            onclick="filtrar('severidade', 'MÃ©dia')"
          >
            MÃ©dia
          </button>
          <button
            class="btn btn-success"
            onclick="filtrar('severidade', 'Baixa')"
          >
            Baixa
          </button>
        </div>
      </div>

      <div>
        <h3>Severidade MÃ©dia por Tela</h3>
        <canvas id="graficoSeveridade" height="100"></canvas>
        <h3>OcorrÃªncias por Tipo de DeficiÃªncia</h3>
        <canvas id="graficoDeficiencia" height="100"></canvas>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered" id="tabelaMetricas">
          <thead class="table-light">
            <tr>
              <th style="width: 20%">DescriÃ§Ã£o da Barreira</th>
              <th style="width: 10%">DeficiÃªncia Impactada</th>
              <th style="width: 10%">Tipo de DeficiÃªncia Impactada</th>
              <th style="width: 8%">Severidade</th>
              <th style="width: 20%">SugestÃ£o de CorreÃ§Ã£o</th>
              <th style="width: 10%">Fonte da Norma</th>
              <th style="width: 15%">Regra Avaliada</th>
              <th style="width: 7%">Status</th>
            </tr>
          </thead>
          <tbody>
            {% for barreira in metricas %}
            <tr>
              <td>{{ barreira['DescriÃ§Ã£o da Barreira'] }}</td>
              <td>{{ barreira['DeficiÃªncia Impactada'] }}</td>
              <td>{{ barreira['Tipo de DeficiÃªncia Impactada'] }}</td>
              <td>{{ barreira['Severidade'] }}</td>
              <td>{{ barreira['SugestÃ£o de CorreÃ§Ã£o'] }}</td>
              <td>{{ barreira['Fonte da Norma'] }}</td>
              <td>{{ barreira['Regra Avaliada'] }}</td>
              <td>{{ barreira['Status'] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <script>
      let filtroDeficiencia = "";
      let filtroSeveridade = "";

      const dados = {{ metricas | default([]) | tojson | safe }};

      let graficoSeveridade;
      let graficoDeficiencia;

      function filtrar(tipo, valor) {
        if (tipo === "deficiencia") {
          filtroDeficiencia = valor;
        } else if (tipo === "severidade") {
          filtroSeveridade = valor;
        }

        const linhas = document.querySelectorAll("#tabelaMetricas tbody tr");
        linhas.forEach((linha) => {
          const deficiencia = linha.cells[2].textContent;
          const severidade = linha.cells[3].textContent;

          const condDef = !filtroDeficiencia || deficiencia.includes(filtroDeficiencia);
          const condSev = !filtroSeveridade || severidade === filtroSeveridade;

          linha.style.display = condDef && condSev ? "" : "none";
        });

        atualizarGraficos();
      }

      function atualizarGraficos() {
        const filtrados = dados.filter((item) => {
          const condDef = !filtroDeficiencia || item["Tipo de DeficiÃªncia Impactada"].includes(filtroDeficiencia);
          const condSev = !filtroSeveridade || item["Severidade"] === filtroSeveridade;
          return condDef && condSev;
        });

        // Atualizar Severidade MÃ©dia por Tela
        const severidades = {};
        filtrados.forEach((item) => {
          const tela = item["Regra Avaliada"];
          const severidade = item["Severidade"] === "Alta" ? 3 :
                            item["Severidade"] === "MÃ©dia" ? 2 :
                            item["Severidade"] === "Baixa" ? 1 : 0;
          if (!severidades[tela]) {
            severidades[tela] = { total: 0, qtd: 0 };
          }
          severidades[tela].total += severidade;
          severidades[tela].qtd += 1;
        });

        const labels = Object.keys(severidades);
        const medias = labels.map((tela) => (severidades[tela].total / severidades[tela].qtd).toFixed(2));

        graficoSeveridade.data.labels = labels;
        graficoSeveridade.data.datasets[0].data = medias;
        graficoSeveridade.update();

        const contagemDeficiencia = {};
        filtrados.forEach((item) => {
          const tipo = item["Tipo de DeficiÃªncia Impactada"];
          if (tipo) {
            contagemDeficiencia[tipo] = (contagemDeficiencia[tipo] || 0) + 1;
          }
        });

        const labelsDef = Object.keys(contagemDeficiencia);
        const valoresDef = labelsDef.map((tipo) => contagemDeficiencia[tipo]);

        graficoDeficiencia.data.labels = labelsDef;
        graficoDeficiencia.data.datasets[0].data = valoresDef;
        graficoDeficiencia.update();
      }

      document.addEventListener("DOMContentLoaded", () => {
        const severidades = {};
        dados.forEach((item) => {
          const tela = item["Regra Avaliada"];
          const severidade = item["Severidade"] === "Alta" ? 3 :
                            item["Severidade"] === "MÃ©dia" ? 2 :
                            item["Severidade"] === "Baixa" ? 1 : 0;
          if (!severidades[tela]) {
            severidades[tela] = { total: 0, qtd: 0 };
          }
          severidades[tela].total += severidade;
          severidades[tela].qtd += 1;
        });

        const labels = Object.keys(severidades);
        const medias = labels.map((tela) => (severidades[tela].total / severidades[tela].qtd).toFixed(2));

        graficoSeveridade = new Chart(document.getElementById("graficoSeveridade"), {
          type: "bar",
          data: {
            labels: labels,
            datasets: [{
              label: "Severidade MÃ©dia",
              data: medias,
              backgroundColor: "rgba(54, 162, 235, 0.7)",
              borderColor: "rgba(54, 162, 235, 1)",
              borderWidth: 1,
            }],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                stepSize: 1,
                max: 3,
                title: {
                  display: true,
                  text: "Severidade (1=Baixa, 2=MÃ©dia, 3=Alta)",
                },
              },
            },
          },
        });

        const contagemDeficiencia = {};
        dados.forEach((item) => {
          const tipo = item["Tipo de DeficiÃªncia Impactada"];
          if (tipo) {
            contagemDeficiencia[tipo] = (contagemDeficiencia[tipo] || 0) + 1;
          }
        });

        const labelsDef = Object.keys(contagemDeficiencia);
        const valoresDef = labelsDef.map((tipo) => contagemDeficiencia[tipo]);

        graficoDeficiencia = new Chart(document.getElementById("graficoDeficiencia"), {
          type: "bar",
          data: {
            labels: labelsDef,
            datasets: [{
              label: "OcorrÃªncias",
              data: valoresDef,
              backgroundColor: "rgba(255, 99, 132, 0.7)",
              borderColor: "rgba(255, 99, 132, 1)",
              borderWidth: 1,
            }],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "NÃºmero de OcorrÃªncias",
                },
                ticks: { precision: 0 },
              },
            },
          },
        });
      });
    </script>
    </main>
    <footer>
      <div class="imagem">
        <p>
          <b>Projeto acadÃªmico em desenvolvimento.</b><br />
          Realizado com os incentivos de:
        </p>
        <div>
          <img
            src="https://hackathonunicesumar.com.br/_assets/media/e4ce6eacf45ee0739892753a88075a7f.png"
            alt="Logo 1"
          />
          <img
            src="https://hackathonunicesumar.com.br/_assets/media/13548fb8c9f6fa48d68e1cd6cff1f047.png"
            alt="Logo 2"
          />
        </div>
      </div>
      <div class="diretrizes">
        <p>Baseado nas diretrizes de Acessibilidade:</p>
        <p>
          <b>
            <a
              href="https://www.w3.org/WAI/standards-guidelines/wcag/"
              target="_blank"
              >WCAG</a
            >
            &
            <a href="https://emag.governoeletronico.gov.br/" target="_blank"
              >eMAG</a
            >
          </b>
        </p>
      </div>
      <div class="github">
        <img
          src="https://img.icons8.com/ios11/512/FFFFFF/github.png"
          alt="GitHub"
        />
        <p>
          RepositÃ³rio no
          <a href="https://github.com/seudominio/seu-projeto" target="_blank"
            ><b>GitHub</b></a
          >
        </p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function toggleContrast() {
        document.body.classList.toggle("high-contrast");
      }
    </script>
  </body>
</html>
